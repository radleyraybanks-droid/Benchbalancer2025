<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bench Balancer - Pro Squad Management</title>

    <!-- Supabase CDN for authentication and database -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <!-- Modern Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Russo+One&family=Poppins:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        /* Modern Dark Theme Variables */
        :root {
            --bg-900: #04070d;
            --bg-880: #060b14;
            --bg-850: #08101a;
            --bg-secondary: #0a1220;
            --bg-card: #0d1626;
            --bg-overlay: rgba(4, 7, 13, 0.85);

            --border-strong: rgba(255, 255, 255, 0.18);
            --border-medium: rgba(255, 255, 255, 0.12);
            --border-faint: rgba(255, 255, 255, 0.06);

            --accent-cyan: #00ffe0;
            --accent-cyan-strong: #00cdb8;
            --accent-green: #1dd1a1;
            --accent-red: #ff5f6d;
            --accent-orange: #ff9966;

            --text-primary: #f5fbff;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;

            --shadow-soft: 0 4px 6px rgba(0, 0, 0, 0.4);
            --shadow-medium: 0 10px 25px rgba(0, 0, 0, 0.5);
            --shadow-strong: 0 20px 40px rgba(0, 0, 0, 0.6);
            --shadow-glow: 0 0 30px rgba(0, 255, 224, 0.3);

            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 24px;

            --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }



        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            background: radial-gradient(circle at 20% 20%, rgba(0, 255, 224, 0.06), transparent 45%),
                radial-gradient(circle at 80% 80%, rgba(124, 92, 255, 0.08), transparent 50%),
                linear-gradient(140deg, var(--bg-900) 0%, var(--bg-880) 55%, #0a0f1d 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header Section */
        #appHeader {
            background: linear-gradient(180deg, rgba(0, 255, 224, 0.08) 0%, rgba(6, 12, 22, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-faint);
            padding: 24px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #appHeader::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-cyan), transparent);
            animation: pulse 3s ease-in-out infinite;
        }

        /* UPGRADE MODAL SPECIFIC */
        #upgradeModal .modal-content {
            border: 3px solid var(--accent-cyan);
            background: #000;
            max-width: 450px;
            text-align: center;
        }

        .upgrade-title {
            font-family: 'Russo One', sans-serif;
            font-size: 42px;
            line-height: 1.1;
            color: #fff;
            margin-bottom: 24px;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .upgrade-list {
            text-align: left;
            color: #fff;
            font-family: 'Russo One', sans-serif;
            font-size: 18px;
            list-style: none;
            padding: 0;
            margin: 0 auto 32px auto;
            display: inline-block;
        }

        .upgrade-list li {
            margin-bottom: 12px;
            position: relative;
            padding-left: 24px;
        }

        .upgrade-list li::before {
            content: '‚Ä¢';
            position: absolute;
            left: 0;
            color: #fff;
        }

        .purchase-btn {
            background: var(--accent-cyan);
            color: #000;
            font-family: 'Russo One', sans-serif;
            font-size: 28px;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            width: 100%;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
        }

        .purchase-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--accent-cyan);
        }

        .cancel-text {
            color: #aaa;
            font-size: 12px;
            margin-top: 12px;
            font-family: 'Roboto', sans-serif;
        }

        /* PRICING STEPS */
        .pricing-option {
            border: 3px solid var(--accent-cyan);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            background: rgba(0, 255, 224, 0.05);
        }

        .pricing-option:hover {
            background: rgba(0, 255, 224, 0.15);
            transform: scale(1.02);
        }

        .pricing-price {
            font-family: 'Russo One', sans-serif;
            font-size: 32px;
            color: #fff;
            margin-bottom: 4px;
        }

        .pricing-period {
            font-family: 'Roboto', sans-serif;
            font-size: 12px;
            color: #ccc;
            text-transform: uppercase;
            font-weight: bold;
        }

        .separator-or {
            font-family: 'Russo One', sans-serif;
            font-size: 24px;
            color: #fff;
            margin: 12px 0;
            text-transform: uppercase;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.3;
            }

            50% {
                opacity: 1;
            }
        }

        .header-brand {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .app-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 32px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--accent-cyan);
            text-shadow: 0 0 20px rgba(0, 255, 224, 0.4);
            line-height: 1;
        }

        .app-subtitle {
            font-family: 'Russo One', sans-serif;
            font-size: 10px;
            letter-spacing: 0.2em;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-top: 4px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn-nav {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-medium);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: var(--transition);
        }

        .btn-nav:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* Professional Header Icon Buttons */
        .header-icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .header-icon-btn:hover {
            background: rgba(0, 255, 224, 0.15);
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
            transform: translateY(-2px);
        }

        /* Professional UPGRADE Button */
        .header-upgrade-btn {
            background: #2d3849;
            border: 2px solid #00ffe0;
            border-radius: 12px;
            padding: 10px 24px;
            color: white;
            font-family: 'Russo One', sans-serif;
            font-size: 14px;
            letter-spacing: 0.1em;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .header-upgrade-btn::before {
            content: 'üíé';
            font-size: 16px;
        }

        .header-upgrade-btn:hover {
            background: rgba(0, 255, 224, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 255, 224, 0.3);
        }

        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Section Title */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 42px;
            letter-spacing: 0.1em;
            color: var(--text-primary);
            margin: 0;
        }

        /* Squad Grid */
        .squad-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
        }

        /* Player Card */
        .player-card {
            background: var(--bg-card);
            border: 1px solid var(--border-faint);
            border-radius: var(--radius-lg);
            padding: 24px;
            position: relative;
            transition: var(--transition);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
            border-color: var(--border-medium);
        }

        .player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-cyan);
            opacity: 0.5;
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .player-name {
            font-family: 'Russo One', sans-serif;
            font-size: 18px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .player-position {
            font-size: 12px;
            color: var(--accent-cyan);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: rgba(0, 255, 224, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .player-details {
            font-size: 13px;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .detail-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badges {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .badge {
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-success {
            background: rgba(29, 209, 161, 0.15);
            color: var(--accent-green);
            border: 1px solid rgba(29, 209, 161, 0.3);
        }

        .badge-warning {
            background: rgba(255, 153, 102, 0.15);
            color: var(--accent-orange);
            border: 1px solid rgba(255, 153, 102, 0.3);
        }

        /* Team Name Header */
        .team-header-container {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }

        .team-name-wrapper {
            position: relative;
            background: rgba(4, 7, 13, 0.6);
            border: 2px solid var(--accent-cyan);
            border-radius: 8px;
            padding: 16px 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 300px;
            box-shadow: 0 0 20px rgba(0, 255, 224, 0.15);
        }

        .team-name-display {
            font-family: 'Russo One', sans-serif;
            font-size: 20px;
            /* Reduced to fit 25 chars */
            text-transform: uppercase;
            color: #fff;
            letter-spacing: 0.1em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .team-name-input {
            background: transparent;
            border: none;
            color: #fff;
            font-family: 'Russo One', sans-serif;
            font-size: 20px;
            /* Reduced to fit 25 chars */
            text-transform: uppercase;
            letter-spacing: 0.1em;
            text-align: center;
            width: 100%;
            outline: none;
            display: none;
        }

        .edit-icon {
            width: 18px;
            height: 18px;
            margin-left: 8px;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .team-name-wrapper:hover .edit-icon {
            opacity: 1;
        }

        /* Updated Add Player Card */
        .add-player-card {
            background: rgba(4, 7, 13, 0.4);
            border: 2px dashed rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 220px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-player-card:hover {
            background: rgba(4, 7, 13, 0.8);
            border-color: var(--accent-cyan);
            box-shadow: 0 0 30px rgba(0, 255, 224, 0.1);
            transform: translateY(-5px);
        }

        .add-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-cyan);
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 16px;
            box-shadow: 0 0 20px rgba(0, 255, 224, 0.5);
            transition: transform 0.3s ease;
        }

        .add-player-card:hover .add-icon {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(0, 255, 224, 0.7);
        }

        .add-text {
            font-family: 'Russo One', sans-serif;
            color: var(--accent-cyan);
            font-size: 16px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(0, 255, 224, 0.2);
        }

        /* --- RESTORED MODAL & FORM CSS --- */

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-overlay);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border-strong);
            border-radius: var(--radius-xl);
            padding: 32px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-strong);
            transform: translateY(20px);
            transition: var(--transition);
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border-faint);
            padding-bottom: 16px;
        }

        .modal-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 28px;
            color: var(--accent-cyan);
            letter-spacing: 0.1em;
        }

        .close-btn {
            background: none;
            border: none;
            width: 28px;
            height: 28px;
            cursor: pointer;
            padding: 0;
            opacity: 0.7;
            transition: opacity 0.2s, transform 0.2s;
        }

        .close-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Form Styling */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .full-width {
            grid-column: span 2;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-cyan);
            background: rgba(0, 255, 224, 0.05);
            box-shadow: 0 0 15px rgba(0, 255, 224, 0.1);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 80px;
        }

        /* Toggle Switch */
        .toggle-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.03);
            padding: 12px 16px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-faint);
        }

        .toggle-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-850);
            border: 1px solid var(--border-medium);
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: var(--text-muted);
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: rgba(29, 209, 161, 0.2);
            border-color: var(--accent-green);
        }

        input:checked+.slider:before {
            transform: translateX(20px);
            background-color: var(--accent-green);
        }

        /* Parent Section */
        .parent-section {
            background: rgba(255, 255, 255, 0.02);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border-faint);
        }

        .parent-header {
            font-size: 12px;
            color: var(--accent-cyan);
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Action Buttons */
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: var(--radius-md);
            font-family: 'Russo One', sans-serif;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-cyan) 0%, var(--accent-cyan-strong) 100%);
            color: var(--bg-900);
            box-shadow: 0 4px 15px rgba(0, 255, 224, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 224, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            border: 1px solid var(--border-medium);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* Checkbox Custom */
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .whatsapp-check {
            accent-color: #25D366;
            width: 16px;
            height: 16px;
        }

        /* Schedule Tile Specifics */
        .schedule-tile-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            gap: 16px;
        }

        .schedule-icon {
            font-size: 48px;
            color: var(--accent-cyan);
            filter: drop-shadow(0 0 10px rgba(0, 255, 224, 0.4));
        }

        /* Game List Styles */
        .game-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .game-card {
            background: rgba(4, 7, 13, 0.6);
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-md);
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--transition);
            cursor: pointer;
        }

        .game-card:hover {
            border-color: var(--accent-cyan);
            background: rgba(4, 7, 13, 0.8);
            transform: translateX(4px);
        }

        .game-info-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .game-opponent {
            font-family: 'Russo One', sans-serif;
            color: var(--text-primary);
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .game-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .game-badge {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge-home {
            background: rgba(29, 209, 161, 0.1);
            color: var(--accent-green);
            border: 1px solid rgba(29, 209, 161, 0.2);
        }

        .badge-away {
            background: rgba(255, 153, 102, 0.1);
            color: var(--accent-orange);
            border: 1px solid rgba(255, 153, 102, 0.2);
        }

        .map-link {
            color: var(--accent-cyan);
            text-decoration: none;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 4px;
        }

        .map-link:hover {
            text-decoration: underline;
        }

        /* Updated Player Card Design */
        .player-card {
            background: linear-gradient(145deg, #1a202c, #2d3748);
            border-radius: 16px;
            padding: 16px;
            position: relative;
            display: flex;
            gap: 16px;
            align-items: flex-start;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
            cursor: pointer;
        }

        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 255, 224, 0.15);
            border-color: rgba(0, 255, 224, 0.3);
        }

        .player-silhouette {
            width: 80px;
            height: 80px;
            background: #000;
            border-radius: 50% 50% 0 0;
            /* Semi-circle-ish */
            border-radius: 50%;
            /* Make it circular for now, effectively */
            display: flex;
            align-items: flex-end;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
            background: #0d1117;
        }

        .player-silhouette svg {
            width: 100%;
            height: 100%;
            fill: #1a202c;
            /* lighter dark */
        }

        /* Using a simple CSS shape for silhouette if no SVG */
        .player-silhouette::after {
            content: '';
            display: block;
            width: 60px;
            height: 60px;
            background: #2d3748;
            border-radius: 50%;
            margin-bottom: -20px;
        }

        .player-silhouette::before {
            content: '';
            position: absolute;
            display: block;
            width: 30px;
            height: 30px;
            background: #2d3748;
            border-radius: 50%;
            margin-top: -35px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }

        .player-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .player-card-name {
            font-family: 'Russo One', sans-serif;
            font-size: 20px;
            color: #fff;
            line-height: 1.2;
        }

        .player-joined-date {
            font-size: 10px;
            color: #a0aec0;
            margin-bottom: 4px;
        }

        .player-matches-count {
            font-family: 'Russo One', sans-serif;
            font-size: 12px;
            color: #fff;
            margin-bottom: 8px;
        }

        .player-notes-preview {
            font-size: 10px;
            color: #cbd5e0;
            line-height: 1.3;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .emergency-contact-label {
            font-size: 10px;
            color: #fc8181;
            /* Red/Orange text */
            font-weight: bold;
            text-transform: uppercase;
        }

        .emergency-contact-text {
            font-family: 'Russo One', sans-serif;
            font-size: 11px;
            color: #fff;
            line-height: 1.2;
        }

        .edit-card-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 24px;
            height: 24px;
            color: var(--accent-cyan);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            /* Above card click */
            font-size: 18px;
        }

        .edit-card-btn:hover {
            color: #fff;
            transform: scale(1.1);
        }

        .consent-checkbox-display.checked {
            background: var(--accent-cyan);
        }

        /* REDESIGNED PLAYER VIEW MODAL */
        .player-view-modal-content {
            background: #1a222e;
            /* Slate-ish dark */
            border: none;
            border-radius: 20px;
            padding: 0;
            width: 95%;
            max-width: 750px;
            text-align: left;
            display: flex;
            flex-direction: row;
            /* 2 Columns */
            overflow: hidden;
            position: relative;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .pv-left-col {
            background: #252e3e;
            /* Slightly lighter/different tone for left sidebar */
            width: 38%;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }

        .pv-right-col {
            background: #1a222e;
            width: 62%;
            padding: 30px 40px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Avatar in Left Col */
        .pv-avatar {
            width: 140px;
            height: 140px;
            background: #000;
            border-radius: 50%;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .pv-avatar::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 100px;
            background: #4a5568;
            border-radius: 50%;
        }

        .pv-avatar::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            background: #4a5568;
            border-radius: 50%;
            z-index: 2;
        }

        /* Contact Section */
        .pv-section-title {
            color: #ff5f6d;
            /* Red color from mock */
            font-family: 'Russo One', sans-serif;
            font-size: 14px;
            text-transform: uppercase;
            width: 100%;
            margin-bottom: 12px;
            margin-top: 8px;
        }

        .pv-contact-row {
            display: flex;
            align-items: center;
            width: 100%;
            margin-bottom: 8px;
            color: #fff;
            gap: 10px;
        }

        .pv-icon {
            width: 16px;
            text-align: center;
            font-size: 14px;
            color: #718096;
        }

        .pv-contact-name {
            font-weight: 700;
            font-size: 16px;
            letter-spacing: 0.02em;
        }

        .pv-contact-phone {
            font-family: 'Russo One', sans-serif;
            font-size: 18px;
            letter-spacing: 0.05em;
        }

        .pv-address {
            font-size: 11px;
            color: #e2e8f0;
            line-height: 1.3;
        }

        .pv-consent-row {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 11px;
            font-weight: bold;
            color: #fff;
        }

        .pv-consent-sub {
            font-size: 9px;
            color: #a0aec0;
            display: block;
            margin-top: -2px;
        }

        /* Right Col Typography */
        .pv-name {
            font-family: 'Russo One', sans-serif;
            font-size: 48px;
            color: #fff;
            line-height: 1;
            margin-bottom: 4px;
        }

        .pv-joined {
            font-size: 12px;
            color: #a0aec0;
            margin-bottom: 24px;
        }

        .pv-stat-row {
            font-size: 16px;
            color: #fff;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .pv-stat-label {
            font-weight: 400;
            color: #a0aec0;
            margin-right: 6px;
        }

        .pv-notes-label {
            font-size: 14px;
            color: #fff;
            font-weight: 700;
            margin-top: 24px;
            margin-bottom: 8px;
        }

        .pv-notes-text {
            font-size: 13px;
            color: #e2e8f0;
            line-height: 1.5;
            flex-grow: 1;
        }

        /* Close Button Override */
        .pv-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            filter: invert(1);
            opacity: 0.5;
            cursor: pointer;
            transition: 0.2s;
            z-index: 10;
        }

        .pv-close-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Mobile Responsive */
        @media (max-width: 650px) {
            .player-view-modal-content {
                flex-direction: column;
                max-height: 90vh;
                overflow-y: auto;
            }

            .pv-left-col,
            .pv-right-col {
                width: 100%;
            }

            .pv-right-col {
                padding-top: 0;
            }
        }

        /* --- STARTING LINEUP MODAL CSS --- */
        .lineup-container {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* Responsive side-by-side on larger screens */
        @media (min-width: 600px) {
            .lineup-container {
                flex-direction: row;
            }

            .lineup-section {
                flex: 1;
            }
        }

        .lineup-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-lg);
            padding: 16px;
            display: flex;
            flex-direction: column;
        }

        .lineup-header {
            font-family: 'Russo One', sans-serif;
            color: var(--accent-cyan);
            margin-bottom: 12px;
            text-align: center;
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 8px;
        }

        .lineup-header.bench-header {
            color: var(--text-secondary);
        }

        .player-list-drag {
            min-height: 200px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-md);
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-grow: 1;
        }

        .draggable-player {
            background: var(--bg-card);
            border: 1px solid var(--border-faint);
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            color: #fff;
            cursor: move;
            /* Fallback */
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-family: 'Russo One', sans-serif;
            font-size: 14px;
            transition: transform 0.2s, background 0.2s, box-shadow 0.2s;
            user-select: none;
            position: relative;
        }

        /* Drag handle if needed, but whole card is better for mobile */

        .draggable-player:active {
            cursor: grabbing;
            background: rgba(0, 255, 224, 0.15);
            border-color: var(--accent-cyan);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .draggable-player.sortable-ghost {
            opacity: 0.4;
            background: var(--accent-cyan);
            border: 2px dashed #fff;
        }

        .draggable-player.sortable-drag {
            background: var(--accent-cyan);
            color: #000;
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        .drag-instruction {
            text-align: center;
            color: var(--text-muted);
            font-size: 12px;
            margin-bottom: 20px;
            font-style: italic;
        }

        /* Footer Navigation - Bottom Tabs */
        .footer-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 0 16px;
            display: flex;
            justify-content: space-around;
            background: #08101a;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            color: #666;
            transition: color 0.2s;
        }

        .nav-item.active {
            color: var(--accent-cyan);
        }

        .nav-icon {
            font-size: 20px;
        }

        .nav-label {
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .nav-icon-img {
            width: 24px;
            height: 24px;
            object-fit: contain;
            opacity: 0.5;
            transition: opacity 0.2s, filter 0.2s;
        }

        .nav-item.active .nav-icon-img {
            opacity: 1;
            filter: drop-shadow(0 0 4px var(--accent-cyan));
        }

        /* Add bottom padding to main container to avoid footer overlap */
        .main-container {
            padding-bottom: 100px;
        }
    </style>
</head>

<body>

    <header id="appHeader">
        <!-- LEFT SECTION: Back + Upgrade -->
        <div style="display:flex; align-items:center; gap:12px;">
            <!-- BACK TO DASHBOARD BUTTON -->
            <a href="basketball-dashboard.html" style="display:flex; align-items:center; gap:6px; background:none; border:2px solid var(--accent-cyan); border-radius:20px; padding:6px 14px; cursor:pointer; transition:all 0.2s; text-decoration:none;" onmouseover="this.style.background='rgba(0,255,224,0.15)'" onmouseout="this.style.background='none'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="#00ffe0" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span style="color:#00ffe0; font-family:'Poppins',sans-serif; font-size:12px; font-weight:600;">BACK</span>
            </a>
            <!-- UPGRADE BUTTON -->
            <button class="header-upgrade-btn" onclick="openUpgradeModal()" style="display:flex; align-items:center; gap:8px; background:linear-gradient(135deg, #1a2a3a 0%, #0d1620 100%); border:2px solid var(--accent-cyan); border-radius:25px; padding:8px 16px; cursor:pointer; transition:all 0.2s;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M12 2L2 9L12 16L22 9L12 2Z" fill="#5bc0de"/>
                    <path d="M2 9L12 16L22 9" stroke="#87ceeb" stroke-width="1"/>
                    <path d="M12 16V22" stroke="#5bc0de" stroke-width="2"/>
                    <path d="M7 19L12 22L17 19" stroke="#5bc0de" stroke-width="2" fill="none"/>
                </svg>
                <span style="color:#fff; font-family:'Russo One',sans-serif; font-size:14px; font-weight:bold; letter-spacing:1px;">UPGRADE</span>
            </button>
        </div>

        <div class="app-title" style="font-family: 'Russo One', sans-serif; font-size: 24px; color: #fff; text-shadow: 0 0 15px var(--accent-cyan);">
            MY TEAM
        </div>

        <div class="header-actions" style="display: flex; gap: 16px; align-items: center;">
            <!-- HELP ICON -->
            <button onclick="alert('Help coming soon!')" style="background:none; border:none; cursor:pointer; padding:4px; transition:transform 0.2s;" onmouseover="this.style.transform='scale(1.15)'" onmouseout="this.style.transform='scale(1)'">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <circle cx="16" cy="16" r="14" stroke="#00ffe0" stroke-width="2.5" fill="none"/>
                    <text x="16" y="21" text-anchor="middle" fill="#00ffe0" font-family="Arial, sans-serif" font-size="18" font-weight="bold">?</text>
                </svg>
            </button>
            <!-- SETTINGS ICON -->
            <button onclick="alert('Settings coming soon!')" style="background:none; border:none; cursor:pointer; padding:4px; transition:transform 0.2s;" onmouseover="this.style.transform='scale(1.15)'" onmouseout="this.style.transform='scale(1)'">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <circle cx="16" cy="16" r="5" stroke="#00ffe0" stroke-width="2.5" fill="none"/>
                    <path d="M16 3V7M16 25V29M3 16H7M25 16H29M6.5 6.5L9.5 9.5M22.5 22.5L25.5 25.5M25.5 6.5L22.5 9.5M9.5 22.5L6.5 25.5" stroke="#00ffe0" stroke-width="2.5" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
    </header>

    <div class="main-container">
        <div class="team-header-container">
            <div class="team-name-wrapper" onclick="toggleTeamNameEdit()">
                <div class="team-name-display" id="teamNameDisplay">
                    YOUR TEAM NAME <img src="assets/icon-edit.png" class="edit-icon" alt="Edit">
                </div>
                <input type="text" class="team-name-input" id="teamNameInput" maxlength="25"
                    onblur="saveTeamName(this.value)" onkeydown="if(event.key === 'Enter') this.blur()">
            </div>
        </div>

        <div class="squad-grid" id="squadGrid">
            <!-- Player Cards will be injected here via JS -->
        </div>
    </div>





    <!-- Player View Modal (Enlarged) -->
    <div class="modal-overlay" id="playerViewModal">
        <div class="player-view-modal-content" onclick="event.stopPropagation()">
            <img src="assets/icon-close.png" class="pv-close-btn" alt="Close" onclick="closePlayerViewModal()">

            <!-- LEFT COLUMN -->
            <div class="pv-left-col">
                <div class="pv-avatar"></div>

                <!-- Emergency Contact 1 -->
                <div class="pv-section-title">Emergency contact:</div>

                <div class="pv-contact-row">
                    <div class="pv-icon">üë§</div>
                    <div class="pv-contact-name" id="viewEmergencyName">Steven</div>
                </div>
                <div class="pv-contact-row">
                    <div class="pv-icon">üìû</div>
                    <div class="pv-contact-phone" id="viewEmergencyPhone">0457633422</div>
                </div>
                <div class="pv-contact-row">
                    <div class="pv-icon">üè†</div>
                    <div class="pv-address" id="viewPlayerAddress">123 street Forresters Beach</div>
                </div>

                <div class="pv-consent-row">
                    <div>
                        Parent Consent
                        <span class="pv-consent-sub">to store player details</span>
                    </div>
                    <div id="viewConsentBox" class="consent-checkbox-display"></div>
                </div>

                <!-- Emergency Contact 2 -->
                <div id="viewParent2Section" style="width:100%; margin-top: 20px; display:none;">
                    <div style="color: #cbd5e0; font-size: 11px; font-weight: bold; margin-bottom: 8px;">Parent/Guardian
                        2: (optional)</div>

                    <div class="pv-contact-row">
                        <div class="pv-icon">üë§</div>
                        <div class="pv-contact-name" id="viewParent2Name">Karen</div>
                    </div>
                    <div class="pv-contact-row">
                        <div class="pv-icon">üìû</div>
                        <div class="pv-contact-phone" id="viewParent2Phone">0457633522</div>
                    </div>
                    <!-- Optional reuse of address if logic dictates, currently using single address field -->
                </div>

            </div>

            <!-- RIGHT COLUMN -->
            <div class="pv-right-col">
                <div class="pv-name" id="viewPlayerName">Jimbo</div>
                <div class="pv-joined" id="viewJoinedDate">Joined 6/12/25</div>

                <!-- Stats/Details -->
                <div class="pv-stat-row">
                    <span class="pv-stat-label">Age:</span> <span id="viewPlayerAge">12</span>
                </div>
                <div class="pv-stat-row">
                    <span class="pv-stat-label">Position:</span> <span id="viewPlayerPosition">Guard</span>
                </div>
                <div class="pv-stat-row">
                    <span class="pv-stat-label">Jersey Number:</span> <span id="viewPlayerJersey">17</span>
                </div>

                <div class="pv-notes-label">Notes:</div>
                <div class="pv-notes-text" id="viewNotes">
                    Strong shooter, weak defense.
                </div>

                <!-- Edit Button - Simplified with explicit z-index -->
                <button id="editProfileBtn" class="btn btn-primary"
                    style="width:auto; align-self: flex-end; margin-top:20px; padding: 10px 24px; position: relative; z-index: 100; pointer-events: auto; cursor: pointer;">
                    EDIT PROFILE
                </button>
            </div>
        </div>
    </div>

    <!-- Starting Lineup Modal -->
    <div class="modal-overlay" id="lineupModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">ADJUST STARTING TEAM</h2>
                <img src="assets/icon-close.png" class="close-btn" alt="Close" onclick="closeLineupModal()">
            </div>

            <p class="drag-instruction">Drag and drop players between lists to set your default starting lineup.</p>

            <div class="lineup-container">
                <!-- Starting XI (or whatever number) -->
                <div class="lineup-section">
                    <div class="lineup-header">STARTING</div>
                    <div id="startingList" class="player-list-drag">
                        <!-- Draggable Items -->
                    </div>
                </div>

                <!-- Bench -->
                <div class="lineup-section">
                    <div class="lineup-header bench-header">BENCH</div>
                    <div id="benchList" class="player-list-drag">
                        <!-- Draggable Items -->
                    </div>
                </div>
            </div>

            <div class="modal-actions" style="margin-top: 32px;">
                <button type="button" class="btn btn-secondary" onclick="closeLineupModal()">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveStartingLineup()">Save Default
                    Lineup</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Player Modal -->
    <div class="modal-overlay" id="playerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Player Profile</h2>
                <img src="assets/icon-close.png" class="close-btn" alt="Close" onclick="closePlayerModal()">
            </div>

            <form id="playerForm" onsubmit="handleSavePlayer(event)">
                <input type="hidden" id="playerId">

                <div class="form-grid">
                    <div class="form-group full-width">
                        <label>Full Name</label>
                        <input type="text" id="playerName" class="form-control" placeholder="e.g. Michael Jordan"
                            required>
                    </div>

                    <div class="form-group">
                        <label>Position</label>
                        <select id="playerPosition" class="form-control">
                            <option value="Guard">Guard</option>
                            <option value="Forward">Forward</option>
                            <option value="Center">Center</option>
                            <option value="Striker">Striker</option>
                            <option value="Midfield">Midfield</option>
                            <option value="Defender">Defender</option>
                            <option value="Keeper">Keeper</option>
                            <option value="Middle">Middle (Oztag)</option>
                            <option value="Link">Link (Oztag)</option>
                            <option value="Winger">Winger (Oztag)</option>
                            <option value="Fullback">Fullback (Oztag)</option>
                            <option value="Utility">Utility</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" id="playerDob" class="form-control">
                    </div>

                    <div class="form-group">
                        <label>Jersey Number</label>
                        <input type="text" id="playerJersey" class="form-control" placeholder="#" maxlength="2">
                    </div>

                    <div class="form-group full-width">
                        <label>Address</label>
                        <input type="text" id="playerAddress" class="form-control" placeholder="Street Address, Suburb">
                    </div>

                    <div class="form-group full-width">
                        <div class="toggle-wrapper">
                            <span class="toggle-label">Parental Consent (Publish Name)</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="parentalConsent">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Parent 1 -->
                    <div class="parent-section full-width">
                        <div class="parent-header">Parent / Guardian 1</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Name</label>
                                <input type="text" id="parent1Name" class="form-control" placeholder="Name">
                            </div>
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="tel" id="parent1Phone" class="form-control" placeholder="0400...">
                            </div>
                            <div class="form-group full-width">
                                <label class="checkbox-wrapper">
                                    <input type="checkbox" id="parent1Whatsapp" class="whatsapp-check">
                                    <span style="font-size: 13px; color: var(--text-secondary);">Add to WhatsApp
                                        Group</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Parent 2 -->
                    <div class="parent-section full-width">
                        <div class="parent-header">Parent / Guardian 2 (Optional)</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Name</label>
                                <input type="text" id="parent2Name" class="form-control" placeholder="Name">
                            </div>
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="tel" id="parent2Phone" class="form-control" placeholder="0400...">
                            </div>
                            <div class="form-group full-width">
                                <label class="checkbox-wrapper">
                                    <input type="checkbox" id="parent2Whatsapp" class="whatsapp-check">
                                    <span style="font-size: 13px; color: var(--text-secondary);">Add to WhatsApp
                                        Group</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label>Coach Notes</label>
                        <textarea id="playerNotes" class="form-control"
                            placeholder="Strengths, weaknesses, medical info..."></textarea>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closePlayerModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Player</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="config/supabase-config.js"></script>
    <script src="auth/auth-manager.js"></script>
    <script src="config/env.js"></script>
    <script type="module" src="config/simple-supabase.js"></script>
    <script type="module">
        import { initAuth } from './config/simple-supabase.js';
        initAuth();
    </script>

    <script>
        // Pro Squad Manager Logic

        // State
        let players = [];
        let teamName = "YOUR TEAM NAME";

        // UUID Generator for Player IDs
        function generateUUID() {
            // Generate a RFC4122 version 4 UUID
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            checkAuth();
            loadTeamName();
            loadPlayers();

            // Auto-open Schedule if requested
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('mode') === 'schedule') {
                // Short timeout to ensure data loaded
                setTimeout(() => {
                    openScheduleModal();

                    if (urlParams.get('action') === 'playNext') {
                        highlightNextGame();
                    }
                }, 100);
            }
        });

        // Team Name Logic
        async function loadTeamName() {
            console.log('[Team Sync] Loading team name...');

            // Try Supabase first
            if (window.benchBalancerSupabase) {
                try {
                    const { data: { user } } = await window.benchBalancerSupabase.auth.getUser();

                    if (user && user.user_metadata?.team_name) {
                        teamName = user.user_metadata.team_name;
                        console.log('[Team Sync] ‚úÖ Loaded team name from Supabase:', teamName);
                        updateTeamNameUI();
                        return;
                    }
                } catch (err) {
                    console.warn('[Team Sync] Error loading team name from Supabase:', err.message);
                }
            }

            // Fallback to localStorage
            const savedName = localStorage.getItem('benchbalancer_team_name');
            if (savedName) {
                teamName = savedName;
                console.log('[Team Sync] Loaded team name from localStorage');
            }
            updateTeamNameUI();
        }

        async function saveTeamName(newName) {
            if (newName && newName.trim() !== "") {
                teamName = newName.trim();

                // Save to localStorage
                localStorage.setItem('benchbalancer_team_name', teamName);

                // Save to Supabase user metadata
                if (window.benchBalancerSupabase) {
                    try {
                        const { data: { user } } = await window.benchBalancerSupabase.auth.getUser();

                        if (user) {
                            const { error } = await window.benchBalancerSupabase.auth.updateUser({
                                data: { team_name: teamName }
                            });

                            if (error) {
                                console.error('[Team Sync] Failed to save team name:', error.message);
                            } else {
                                console.log('[Team Sync] ‚úÖ Team name saved to Supabase');
                            }
                        }
                    } catch (err) {
                        console.error('[Team Sync] Error saving team name:', err.message);
                    }
                }
            }
            updateTeamNameUI();
            toggleTeamNameEdit(false);
        }

        function updateTeamNameUI() {
            document.getElementById('teamNameDisplay').innerHTML = `${teamName} <img src="assets/icon-edit.png" class="edit-icon" alt="Edit">`
            document.getElementById('teamNameInput').value = teamName;
        }

        function toggleTeamNameEdit(forceEdit) {
            const display = document.getElementById('teamNameDisplay');
            const input = document.getElementById('teamNameInput');

            if (forceEdit === false) {
                display.style.display = 'flex';
                input.style.display = 'none';
            } else if (forceEdit === true) {
                display.style.display = 'none';
                input.style.display = 'block';
                input.focus();
            } else {
                // Toggle
                if (input.style.display === 'none' || input.style.display === '') {
                    display.style.display = 'none';
                    input.style.display = 'block';
                    input.focus();
                } else {
                    display.style.display = 'flex';
                    input.style.display = 'none';
                }
            }
        }

        async function checkAuth() {
            // Simple check to ensure user is logged in
            // In a real app, we'd verify the session with Supabase
            const session = localStorage.getItem('sb-pomcalscfnwsqlscunxf-auth-token'); // Supabase default key pattern
            // For now, we'll rely on our simple-supabase.js checkCurrentUser logic if possible, 
            // but since we want to be robust, we'll just assume if they got here via the link they might be okay, 
            // or we redirect if no user found in window.benchBalancerSupabase later.
        }

        async function loadPlayers() {
            console.log('[Team Sync] Loading players...');

            // Wait for Supabase to be ready before trying to load
            if (window.supabaseReady) {
                try {
                    await window.supabaseReady;
                    console.log('[Team Sync] Supabase ready, proceeding with load');
                } catch (e) {
                    console.warn('[Team Sync] Supabase initialization failed, using localStorage');
                }
            }

            // Try to load from Supabase first (source of truth)
            if (window.benchBalancerSupabase) {
                try {
                    const { data: { user } } = await window.benchBalancerSupabase.auth.getUser();

                    if (user) {
                        console.log('[Team Sync] Fetching roster from Supabase for user:', user.id);

                        const { data, error } = await window.benchBalancerSupabase
                            .from('teams_roster')
                            .select('*')
                            .eq('user_id', user.id)
                            .order('name', { ascending: true });

                        if (error) {
                            console.warn('[Team Sync] Supabase fetch failed:', error.message);
                            console.log('[Team Sync] Falling back to localStorage');
                        } else if (data && data.length > 0) {
                            console.log(`[Team Sync] ‚úÖ Loaded ${data.length} players from Supabase`);

                            // Convert Supabase format to app format
                            players = data.map(row => {
                                const contact = row.parent_contact || {};
                                return {
                                    id: row.id,
                                    name: row.name,
                                    jersey: row.jersey_number,
                                    position: row.position || '',
                                    notes: row.notes || '',

                                    // Extended fields stored in parent_contact JSON
                                    dob: contact.dob || '',
                                    address: contact.address || '',
                                    consent: contact.consent || false,

                                    // Parent 1
                                    parent1Name: contact.parent1Name || '',
                                    parent1Phone: contact.parent1Phone || '',
                                    parent1Whatsapp: contact.parent1Whatsapp || false,

                                    // Parent 2
                                    parent2Name: contact.parent2Name || '',
                                    parent2Phone: contact.parent2Phone || '',
                                    parent2Whatsapp: contact.parent2Whatsapp || false
                                };
                            });

                            // Update localStorage cache
                            localStorage.setItem('benchbalancer_pro_squad', JSON.stringify(players));

                            // Update global reference for edit button handler
                            window.players = players;

                            renderSquad();
                            return;
                        } else {
                            console.log('[Team Sync] No players found in Supabase, checking localStorage');
                        }
                    }
                } catch (err) {
                    console.warn('[Team Sync] Error loading from Supabase:', err.message);
                }
            }

            // Fallback: Load from localStorage (offline or not authenticated)
            const saved = localStorage.getItem('benchbalancer_pro_squad');
            if (saved) {
                players = JSON.parse(saved);
                window.players = players;  // Update global reference
                console.log('[Team Sync] Loaded from localStorage (offline mode)');
            }

            // Always render, even if empty (so the Add button shows)
            window.players = players;  // Ensure global ref is always current
            renderSquad();
        }

        async function savePlayers() {
            // Save to localStorage immediately for offline support
            localStorage.setItem('benchbalancer_pro_squad', JSON.stringify(players));
            renderSquad();

            // Sync with Supabase in background
            await syncWithSupabase();
        }

        async function syncWithSupabase() {
            if (!window.benchBalancerSupabase) {
                console.log('[Team Sync] ‚ö† Offline mode - skipping Supabase sync');
                return;
            }

            try {
                const { data: { user } } = await window.benchBalancerSupabase.auth.getUser();

                if (!user) {
                    console.log('[Team Sync] ‚ö† No authenticated user - skipping sync');
                    return;
                }

                console.log('[Team Sync] Syncing ${players.length} players to Supabase...');

                // Get existing roster from Supabase
                const { data: existingRoster, error: fetchError } = await window.benchBalancerSupabase
                    .from('teams_roster')
                    .select('id')
                    .eq('user_id', user.id);

                if (fetchError) {
                    console.error('[Team Sync] Failed to fetch existing roster:', fetchError.message);
                    return;
                }

                const existingIds = (existingRoster || []).map(r => r.id);
                const currentIds = players.map(p => p.id);

                // Delete removed players
                const toDelete = existingIds.filter(id => !currentIds.includes(id));
                if (toDelete.length > 0) {
                    console.log(`[Team Sync] Deleting ${toDelete.length} removed players...`);
                    const { error: deleteError } = await window.benchBalancerSupabase
                        .from('teams_roster')
                        .delete()
                        .in('id', toDelete);

                    if (deleteError) {
                        console.error('[Team Sync] Delete failed:', deleteError.message);
                    }
                }

                // Upsert all current players
                const playersToSync = players.map(player => ({
                    id: player.id,
                    user_id: user.id,
                    name: player.name,
                    jersey_number: player.jersey || null,
                    position: player.position || null,
                    notes: player.notes || null,
                    // Store extended details in JSONB column to avoid schema migration
                    parent_contact: {
                        dob: player.dob || '',
                        address: player.address || '',
                        consent: player.consent || false,

                        parent1Name: player.parent1Name || '',
                        parent1Phone: player.parent1Phone || '',
                        parent1Whatsapp: player.parent1Whatsapp || false,

                        parent2Name: player.parent2Name || '',
                        parent2Phone: player.parent2Phone || '',
                        parent2Whatsapp: player.parent2Whatsapp || false
                    },
                    updated_at: new Date().toISOString()
                }));

                const { error: upsertError } = await window.benchBalancerSupabase
                    .from('teams_roster')
                    .upsert(playersToSync, { onConflict: 'id' });

                if (upsertError) {
                    console.error('[Team Sync] ‚ùå Upsert failed:', upsertError.message);
                } else {
                    console.log('[Team Sync] ‚úÖ Successfully synced to Supabase');
                }
            } catch (err) {
                console.error('[Team Sync] ‚ùå Sync error:', err.message);
            }
        }

        function renderSquad() {
            const grid = document.getElementById('squadGrid');
            grid.innerHTML = '';

            // 1. Add Player Card (Always First)
            const addCard = document.createElement('div');
            addCard.className = 'add-player-card';
            addCard.onclick = () => openPlayerModal(); // Opens "Add New" form
            addCard.innerHTML = `
                <div class="add-icon">+</div>
                <div class="add-text">Add New Player</div>
            `;
            grid.appendChild(addCard);

            // Add Schedule Tile (if logical for function order, but we handle it in loadSchedule too)
            // It will be re-injected by loadSchedule() calling renderScheduleTile() which appends carefully.
            // But to be safe, renderScheduleTile() should handle its own existence.

            // 2. Render Existing Players
            const sortedPlayers = [...players].sort((a, b) => a.name.localeCompare(b.name));

            sortedPlayers.forEach(player => {
                const card = document.createElement('div');
                card.className = 'player-card';
                // Click on card opens View Modal
                card.onclick = (e) => {
                    // Prevent firing if clicking edit button
                    if (!e.target.closest('.edit-card-btn')) {
                        viewPlayer(player.id);
                    }
                };

                // Mock Data for Design Compatibility
                const joinedDate = player.joinedDate || "Joined 6/12/25"; // Mock default
                const gamesPlayed = player.gamesPlayed || "1 Game played";
                const parentName = player.parent1Name || player.parent2Name || "Parent";
                const parentPhone = player.parent1Phone || player.parent2Phone || "No Phone";

                card.innerHTML = `
                    <div class="edit-card-btn" onclick="editPlayer('${player.id}')">
                         <img src="assets/icon-edit.png" style="width: 16px; height: 16px; opacity: 0.8;" alt="Edit">
                    </div>
                    
                    <div class="player-silhouette">
                        <!-- CSS Shapes -->
                    </div>

                    <div class="player-info">
                        <div class="player-card-name">
                            ${player.jersey ? `<span style="color:var(--accent-cyan); margin-right:4px;">#${player.jersey}</span> ` : ''}
                            ${player.name}
                        </div>
                        <div class="player-joined-date">${joinedDate}</div>
                        <div class="player-matches-count">${gamesPlayed}</div>
                        
                        <div class="player-notes-preview">
                            ${player.notes ? player.notes : 'No notes added.'}
                        </div>
                        
                        <div style="margin-top: auto;">
                            <div class="emergency-contact-label">Emergency contact:</div>
                            <div class="emergency-contact-text">${parentName}</div>
                            <div class="emergency-contact-text">${parentPhone}</div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            // Ensure Schedule Tile is present after render
            // REMOVED at user request: if (typeof renderScheduleTile === 'function') renderScheduleTile();
        }

        // --- Player View Logic ---
        const playerViewModal = document.getElementById('playerViewModal');

        function viewPlayer(id) {
            const player = players.find(p => p.id === id);
            if (!player) return;

            // Store ID for editing
            document.getElementById('playerViewModal').dataset.playerId = id;

            // Name & Join Date
            document.getElementById('viewPlayerName').innerText = player.name;
            document.getElementById('viewJoinedDate').innerText = player.joinedDate || "Joined recent";

            // Age Calculation
            let ageDisplay = "-";
            if (player.dob) {
                const birthDate = new Date(player.dob);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const m = today.getMonth() - birthDate.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                ageDisplay = age;
            }
            document.getElementById('viewPlayerAge').innerText = ageDisplay;

            // Details
            document.getElementById('viewPlayerPosition').innerText = player.position || "-";
            document.getElementById('viewPlayerJersey').innerText = player.jersey || "-";
            document.getElementById('viewNotes').innerText = player.notes || "No notes.";

            // Parent 1 (Emergency)
            document.getElementById('viewEmergencyName').innerText = player.parent1Name || player.parent2Name || "No Contact";
            document.getElementById('viewEmergencyPhone').innerText = player.parent1Phone || player.parent2Phone || "-";
            document.getElementById('viewPlayerAddress').innerText = player.address || "";

            // Consent
            const consentBox = document.getElementById('viewConsentBox');
            if (player.consent) {
                consentBox.classList.add('checked');
            } else {
                consentBox.classList.remove('checked');
            }

            // Parent 2 (Optional)
            const p2Section = document.getElementById('viewParent2Section');
            if (player.parent2Name) {
                p2Section.style.display = 'block';
                document.getElementById('viewParent2Name').innerText = player.parent2Name;
                document.getElementById('viewParent2Phone').innerText = player.parent2Phone || "-";
            } else {
                p2Section.style.display = 'none';
            }

            playerViewModal.classList.add('active');
        }

        function closePlayerViewModal() {
            playerViewModal.classList.remove('active');
        }

        function editCurrentViewPlayer() {
            // Get elements FRESH every time - don't rely on global variables
            const viewModal = document.getElementById('playerViewModal');
            const playerId = viewModal ? viewModal.dataset.playerId : null;

            console.log('[Edit Flow] Edit button clicked. Player ID from dataset:', playerId);

            if (!playerId) {
                console.error('[Edit Flow] ERROR: No player ID found in dataset');
                alert('Error: No player selected. Please try clicking the player card again.');
                return;
            }

            // Find the player using STRING comparison to avoid type mismatch
            const player = players.find(p => String(p.id) === String(playerId));

            if (!player) {
                console.error('[Edit Flow] ERROR: Player not found for ID:', playerId);
                console.log('[Edit Flow] Available players:', players.map(p => ({ id: p.id, name: p.name })));
                alert('Error: Player data not found. Please refresh the page.');
                return;
            }

            console.log('[Edit Flow] Found player to edit:', player.name);

            // Get the edit modal FRESH
            const editModal = document.getElementById('playerModal');
            const editForm = document.getElementById('playerForm');

            if (!editModal) {
                console.error('[Edit Flow] ERROR: #playerModal element not found in DOM');
                alert('Error: Edit form not found. Please refresh the page.');
                return;
            }

            // Close the view modal FIRST
            if (viewModal) {
                viewModal.classList.remove('active');
            }

            // Reset form if it exists
            if (editForm) {
                editForm.reset();
            }

            // Helper functions for safe field population
            const setField = (id, value) => {
                const el = document.getElementById(id);
                if (el) el.value = value || '';
            };
            const setCheck = (id, value) => {
                const el = document.getElementById(id);
                if (el) el.checked = !!value;
            };

            // Populate ALL form fields with player data
            setField('playerId', player.id);
            setField('playerName', player.name);
            setField('playerPosition', player.position);
            setField('playerDob', player.dob);
            setField('playerAddress', player.address);
            setField('playerJersey', player.jersey);
            setField('playerNotes', player.notes);
            setCheck('parentalConsent', player.consent);
            setField('parent1Name', player.parent1Name);
            setField('parent1Phone', player.parent1Phone);
            setCheck('parent1Whatsapp', player.parent1Whatsapp);
            setField('parent2Name', player.parent2Name);
            setField('parent2Phone', player.parent2Phone);
            setCheck('parent2Whatsapp', player.parent2Whatsapp);

            // FORCE the modal to be visible
            console.log('[Edit Flow] Opening edit modal NOW...');
            editModal.classList.add('active');
            editModal.style.opacity = '1';
            editModal.style.pointerEvents = 'auto';

            // Scroll to top
            const content = editModal.querySelector('.modal-content');
            if (content) content.scrollTop = 0;

            console.log('[Edit Flow] Edit modal should now be visible. Classes:', editModal.className);
        }

        // Close modal on outside click
        const pvModalRef = document.getElementById('playerViewModal');
        if (pvModalRef) {
            pvModalRef.onclick = (e) => {
                if (e.target === pvModalRef) closePlayerViewModal();
            }
        }

        // Modal Functions - Get fresh references each time
        function openPlayerModal() {
            console.log('[Edit Flow] Opening Add Player Modal');
            const modalEl = document.getElementById('playerModal');
            const formEl = document.getElementById('playerForm');

            if (!modalEl) {
                console.error('[Edit Flow] ERROR: playerModal not found');
                return;
            }

            if (formEl) formEl.reset();

            const pidInput = document.getElementById('playerId');
            const jerseyInput = document.getElementById('playerJersey');
            if (pidInput) pidInput.value = '';
            if (jerseyInput) jerseyInput.value = '';

            modalEl.classList.add('active');
            modalEl.style.opacity = '1';
            modalEl.style.pointerEvents = 'auto';

            const modalContent = modalEl.querySelector('.modal-content');
            if (modalContent) modalContent.scrollTop = 0;
        }

        function closePlayerModal() {
            const modalEl = document.getElementById('playerModal');
            if (modalEl) {
                modalEl.classList.remove('active');
                modalEl.style.opacity = '';
                modalEl.style.pointerEvents = '';
            }
        }

        // Legacy editPlayer function - now redirects to editCurrentViewPlayer logic
        function editPlayer(id) {
            console.log('[Edit Flow] editPlayer called with:', id);

            // Set the ID in the dataset and call the main edit function
            const viewModal = document.getElementById('playerViewModal');
            if (viewModal) {
                viewModal.dataset.playerId = id;
            }

            // Use the same logic as editCurrentViewPlayer but without closing view modal
            const player = players.find(p => String(p.id) === String(id));

            if (!player) {
                console.error('[Edit Flow] Player not found for ID:', id);
                return;
            }

            const editModal = document.getElementById('playerModal');
            const editForm = document.getElementById('playerForm');

            if (!editModal) {
                console.error('[Edit Flow] playerModal not found');
                return;
            }

            if (editForm) editForm.reset();

            const setField = (elemId, value) => {
                const el = document.getElementById(elemId);
                if (el) el.value = value || '';
            };
            const setCheck = (elemId, value) => {
                const el = document.getElementById(elemId);
                if (el) el.checked = !!value;
            };

            setField('playerId', player.id);
            setField('playerName', player.name);
            setField('playerPosition', player.position);
            setField('playerDob', player.dob);
            setField('playerAddress', player.address);
            setField('playerJersey', player.jersey);
            setField('playerNotes', player.notes);
            setCheck('parentalConsent', player.consent);
            setField('parent1Name', player.parent1Name);
            setField('parent1Phone', player.parent1Phone);
            setCheck('parent1Whatsapp', player.parent1Whatsapp);
            setField('parent2Name', player.parent2Name);
            setField('parent2Phone', player.parent2Phone);
            setCheck('parent2Whatsapp', player.parent2Whatsapp);

            editModal.classList.add('active');
            editModal.style.opacity = '1';
            editModal.style.pointerEvents = 'auto';

            const content = editModal.querySelector('.modal-content');
            if (content) content.scrollTop = 0;
        }

        function handleSavePlayer(e) {
            e.preventDefault();

            const id = document.getElementById('playerId').value || generateUUID();

            const playerData = {
                id: id,
                name: document.getElementById('playerName').value,
                position: document.getElementById('playerPosition').value,
                dob: document.getElementById('playerDob').value,
                address: document.getElementById('playerAddress').value,
                position: document.getElementById('playerPosition').value,
                jersey: document.getElementById('playerJersey').value.replace(/[^0-9]/g, '').slice(0, 2), // Numeric only
                dob: document.getElementById('playerDob').value,
                address: document.getElementById('playerAddress').value,
                consent: document.getElementById('parentalConsent').checked,
                notes: document.getElementById('playerNotes').value,

                parent1Name: document.getElementById('parent1Name').value,
                parent1Phone: document.getElementById('parent1Phone').value,
                parent1Whatsapp: document.getElementById('parent1Whatsapp').checked,

                parent2Name: document.getElementById('parent2Name').value,
                parent2Phone: document.getElementById('parent2Phone').value,
                parent2Whatsapp: document.getElementById('parent2Whatsapp').checked,
            };

            const existingIndex = players.findIndex(p => p.id === id);
            if (existingIndex >= 0) {
                players[existingIndex] = playerData;
            } else {
                players.push(playerData);
            }

            savePlayers();
            closePlayerModal();

            // Show success animation or toast?
            // alert('Player saved!'); 
        }

        // Logout
        // Logout Logic
        async function handleSignOut() {
            if (confirm('Are you sure you want to sign out?')) {
                try {
                    if (window.benchBalancerSupabase) {
                        await window.benchBalancerSupabase.auth.signOut();
                    }
                    // Clear local cache for consistency
                    localStorage.removeItem('sb-pomcalscfnwsqlscunxf-auth-token');
                    window.location.href = 'index.html';
                } catch (e) {
                    console.error('Logout error', e);
                    window.location.href = 'index.html';
                }
            }
        }



        // Chain load
        const originalLoadPlayers = window.loadPlayers || loadPlayers;
        window.loadPlayers = function () {
            if (typeof originalLoadPlayers === 'function') originalLoadPlayers();
        };

        // ===== STARTING LINEUP MANAGEMENT =====

        function openLineupModal() {
            const modal = document.getElementById('lineupModal');
            if (!modal) return;

            // Populate lists with current players
            const startingList = document.getElementById('startingList');
            const benchList = document.getElementById('benchList');

            if (!startingList || !benchList) return;

            // Clear lists
            startingList.innerHTML = '';
            benchList.innerHTML = '';

            // Load saved lineup from user metadata
            loadStartingLineup().then(() => {
                // Create draggable items for each player
                players.forEach(player => {
                    const item = document.createElement('div');
                    item.className = 'drag-player-item';
                    item.dataset.playerId = player.id;
                    item.innerHTML = `
                        <span>${player.name}</span>
                        ${player.jersey ? `<span class="player-jersey">#${player.jersey}</span>` : ''}
                    `;

                    // Check if player is in starting lineup
                    if (player.isStarter) {
                        startingList.appendChild(item);
                    } else {
                        benchList.appendChild(item);
                    }
                });

                // Initialize Sortable for drag & drop
                if (window.Sortable) {
                    new Sortable(startingList, {
                        group: 'lineup',
                        animation: 150
                    });
                    new Sortable(benchList, {
                        group: 'lineup',
                        animation: 150
                    });
                }

                modal.classList.add('active');
            });
        }

        function closeLineupModal() {
            const modal = document.getElementById('lineupModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }

        async function saveStartingLineup() {
            const startingList = document.getElementById('startingList');
            const benchList = document.getElementById('benchList');

            if (!startingList || !benchList) return;

            // Get player IDs from starting list
            const starterIds = Array.from(startingList.children).map(el => el.dataset.playerId);

            // Update players array with starter status
            players.forEach(player => {
                player.isStarter = starterIds.includes(player.id);
            });

            // Save to localStorage
            localStorage.setItem('benchbalancer_pro_squad', JSON.stringify(players));

            // Save to Supabase user metadata
            if (window.benchBalancerSupabase) {
                try {
                    const { data: { user } } = await window.benchBalancerSupabase.auth.getUser();

                    if (user) {
                        const { error } = await window.benchBalancerSupabase.auth.updateUser({
                            data: {
                                starting_lineup: starterIds
                            }
                        });

                        if (error) {
                            console.error('[Lineup Sync] Failed to save:', error.message);
                            alert('‚ö†Ô∏è Failed to save lineup to cloud. Saved locally only.');
                        } else {
                            console.log('[Lineup Sync] ‚úÖ Saved to Supabase');
                            alert('‚úÖ Starting lineup saved successfully!');
                        }
                    }
                } catch (err) {
                    console.error('[Lineup Sync] Error:', err.message);
                }
            }

            // Sync full roster to database
            await syncWithSupabase();

            closeLineupModal();
        }

        async function loadStartingLineup() {
            // Try to load from Supabase user metadata
            if (window.benchBalancerSupabase) {
                try {
                    const { data: { user } } = await window.benchBalancerSupabase.auth.getUser();

                    if (user && user.user_metadata?.starting_lineup) {
                        const starterIds = user.user_metadata.starting_lineup;
                        console.log('[Lineup Sync] ‚úÖ Loaded lineup from Supabase');

                        // Update players with starter status
                        players.forEach(player => {
                            player.isStarter = starterIds.includes(player.id);
                        });
                        return;
                    }
                } catch (err) {
                    console.warn('[Lineup Sync] Error loading from Supabase:', err.message);
                }
            }

            // Fallback: all players are bench by default
            players.forEach(player => {
                if (player.isStarter === undefined) {
                    player.isStarter = false;
                }
            });
        }

        // Make functions globally available
        window.openLineupModal = openLineupModal;
        window.closeLineupModal = closeLineupModal;
        window.saveStartingLineup = saveStartingLineup;
    </script>
    <!-- Upgrade Modal -->
    <div class="modal-overlay" id="upgradeModal" onclick="closeUpgradeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 520px;">
            <!-- Close X -->
            <img src="assets/icon-close.png"
                style="position:absolute; top:16px; right:16px; width:28px; height:28px; cursor:pointer;"
                onclick="closeUpgradeModal()">

            <div id="upgradeStep1">
                <div class="upgrade-title">
                    CHOOSE YOUR<br>PLAN
                </div>

                <p style="color: #94a3b8; font-size: 14px; margin-bottom: 20px; line-height: 1.5;">
                    Unlock unlimited matches, full statistics, and permanent match history.
                </p>

                <!-- Pro Plan -->
                <div class="pricing-option" onclick="showProOptions()" style="margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div class="pricing-price" style="font-size: 24px; text-align: left;">PRO</div>
                            <div class="pricing-period" style="text-align: left;">1 sport - Unlimited matches</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: #00ffe0; font-family: 'Russo One', sans-serif; font-size: 20px;">$5.99</div>
                            <div style="color: #888; font-size: 11px;">/month</div>
                        </div>
                    </div>
                </div>

                <!-- Elite Plan -->
                <div class="pricing-option" onclick="showEliteOptions()" style="border-color: #ffd700; background: rgba(255, 215, 0, 0.08); position: relative;">
                    <div style="position: absolute; top: -10px; right: 12px; background: linear-gradient(90deg, #ffd700, #ffaa00); color: #000; font-size: 9px; font-weight: bold; padding: 3px 10px; border-radius: 10px; font-family: 'Russo One', sans-serif; letter-spacing: 0.5px;">BEST VALUE</div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div class="pricing-price" style="font-size: 24px; text-align: left; color: #ffd700;">ELITE</div>
                            <div class="pricing-period" style="text-align: left; color: #ccc;">All sports - Unlimited matches</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: #ffd700; font-family: 'Russo One', sans-serif; font-size: 20px;">$9.95</div>
                            <div style="color: #888; font-size: 11px;">/month</div>
                        </div>
                    </div>
                </div>

                <a href="pricing.html" style="display: block; color: #00ffe0; font-size: 13px; margin-top: 20px; text-decoration: underline;">Compare all features</a>
                <div class="cancel-text">Cancel anytime</div>
            </div>

            <!-- Pro Pricing Options -->
            <div id="upgradeStepPro" style="display:none;">
                <div class="upgrade-title" style="font-size: 32px;">
                    PRO PLAN
                </div>
                <p style="color: #94a3b8; font-size: 13px; margin-bottom: 20px;">
                    Unlimited matches for this sport. Full stats & match history.
                </p>

                <div class="pricing-option" onclick="selectPricing('pro_monthly')">
                    <div class="pricing-price">$5.99/month</div>
                    <div class="pricing-period">Billed monthly</div>
                </div>

                <div class="separator-or">Or</div>

                <div class="pricing-option" onclick="selectPricing('pro_halfyearly')">
                    <div class="pricing-price">$29.99/6 months</div>
                    <div class="pricing-period">Save 17% - Billed half yearly</div>
                </div>

                <button onclick="showStep1()" style="background: none; border: none; color: #00ffe0; font-size: 13px; margin-top: 20px; cursor: pointer; text-decoration: underline;">Back to plans</button>
                <div class="cancel-text">Cancel anytime</div>
            </div>

            <!-- Elite Pricing Options -->
            <div id="upgradeStepElite" style="display:none;">
                <div class="upgrade-title" style="font-size: 32px; color: #ffd700;">
                    ELITE PLAN
                </div>
                <p style="color: #94a3b8; font-size: 13px; margin-bottom: 20px;">
                    Access ALL sports: Soccer, Basketball, Tag Football, AFL & more. Priority support included.
                </p>

                <div class="pricing-option" onclick="selectPricing('elite_monthly')" style="border-color: #ffd700;">
                    <div class="pricing-price" style="color: #ffd700;">$9.95/month</div>
                    <div class="pricing-period">Billed monthly</div>
                </div>

                <div class="separator-or">Or</div>

                <div class="pricing-option" onclick="selectPricing('elite_halfyearly')" style="border-color: #ffd700;">
                    <div class="pricing-price" style="color: #ffd700;">$49.95/6 months</div>
                    <div class="pricing-period">Save 17% - Billed half yearly</div>
                </div>

                <button onclick="showStep1()" style="background: none; border: none; color: #ffd700; font-size: 13px; margin-top: 20px; cursor: pointer; text-decoration: underline;">Back to plans</button>
                <div class="cancel-text">Cancel anytime</div>
            </div>
        </div>
    </div>

    <!-- Upgrade JS -->
    <script>
        function openUpgradeModal() {
            // Reset to step 1
            showStep1();
            document.getElementById('upgradeModal').classList.add('active');
        }

        function closeUpgradeModal(e) {
            if (e) e.stopPropagation();
            document.getElementById('upgradeModal').classList.remove('active');
        }

        function showStep1() {
            document.getElementById('upgradeStep1').style.display = 'block';
            document.getElementById('upgradeStepPro').style.display = 'none';
            document.getElementById('upgradeStepElite').style.display = 'none';
        }

        function showProOptions() {
            document.getElementById('upgradeStep1').style.display = 'none';
            document.getElementById('upgradeStepPro').style.display = 'block';
            document.getElementById('upgradeStepElite').style.display = 'none';
        }

        function showEliteOptions() {
            document.getElementById('upgradeStep1').style.display = 'none';
            document.getElementById('upgradeStepPro').style.display = 'none';
            document.getElementById('upgradeStepElite').style.display = 'block';
        }

        function selectPricing(plan) {
            // TODO: Replace with Stripe checkout redirect
            // Example: window.location.href = 'https://checkout.stripe.com/pay/your_price_id?client_reference_id=' + userId;
            const planNames = {
                'pro_monthly': 'Pro Monthly ($5.99/mo)',
                'pro_halfyearly': 'Pro 6-Month ($29.99)',
                'elite_monthly': 'Elite Monthly ($9.95/mo)',
                'elite_halfyearly': 'Elite 6-Month ($49.95)'
            };
            alert('Selected: ' + planNames[plan] + '\n\nStripe payment integration coming soon.');
        }

        // =========================================
        // EDIT BUTTON FIX - JavaScript Event Listener
        // =========================================
        // Make players globally accessible
        window.players = players;

        // Attach edit button handler when DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            console.log('[Edit Setup] Attaching edit button handler...');

            var editBtn = document.getElementById('editProfileBtn');
            if (editBtn) {
                console.log('[Edit Setup] Edit button found, attaching click handler');
                editBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    console.log('[Edit Click] Button clicked!');

                    var viewModal = document.getElementById('playerViewModal');
                    var playerId = viewModal ? viewModal.dataset.playerId : null;

                    console.log('[Edit Click] Player ID:', playerId);

                    if (!playerId) {
                        console.error('[Edit Click] ERROR: No player ID found');
                        return;
                    }

                    var allPlayers = window.players || players || [];
                    console.log('[Edit Click] Players array length:', allPlayers.length);

                    var player = allPlayers.find(function (p) {
                        return String(p.id) === String(playerId);
                    });

                    if (!player) {
                        console.error('[Edit Click] Player not found for ID:', playerId);
                        console.log('[Edit Click] Available IDs:', allPlayers.map(function (p) { return p.id; }));
                        return;
                    }

                    console.log('[Edit Click] Found player:', player.name);

                    // Close view modal
                    if (viewModal) {
                        viewModal.classList.remove('active');
                    }

                    // Open edit modal
                    var editModal = document.getElementById('playerModal');
                    var editForm = document.getElementById('playerForm');

                    if (!editModal) {
                        alert('ERROR: Edit modal element not found');
                        return;
                    }

                    if (editForm) editForm.reset();

                    // Populate fields
                    function setVal(id, v) { var el = document.getElementById(id); if (el) el.value = v || ''; }
                    function setChk(id, v) { var el = document.getElementById(id); if (el) el.checked = !!v; }

                    setVal('playerId', player.id);
                    setVal('playerName', player.name);
                    setVal('playerPosition', player.position);
                    setVal('playerDob', player.dob);
                    setVal('playerAddress', player.address);
                    setVal('playerJersey', player.jersey);
                    setVal('playerNotes', player.notes);
                    setChk('parentalConsent', player.consent);
                    setVal('parent1Name', player.parent1Name);
                    setVal('parent1Phone', player.parent1Phone);
                    setChk('parent1Whatsapp', player.parent1Whatsapp);
                    setVal('parent2Name', player.parent2Name);
                    setVal('parent2Phone', player.parent2Phone);
                    setChk('parent2Whatsapp', player.parent2Whatsapp);

                    // Force show edit modal
                    editModal.classList.add('active');
                    editModal.style.opacity = '1';
                    editModal.style.pointerEvents = 'auto';

                    console.log('[Edit Click] Edit modal opened successfully');
                }, true);  // true = capture phase, catches click before any other handlers
            } else {
                console.error('[Edit Setup] ERROR: editProfileBtn not found in DOM');
            }
        });
    </script>

    <!-- Bottom Navigation -->
    <nav class="footer-nav">
        <a href="basketball-dashboard.html" class="nav-item">
            <img src="assets/icon-home.png" class="nav-icon-img" alt="Home">
            <span class="nav-label">HOME</span>
        </a>
        <a href="pro-squad-management.html" class="nav-item active">
            <img src="assets/icon-teams.png" class="nav-icon-img" alt="Teams">
            <span class="nav-label">TEAMS</span>
        </a>
        <a href="basketball-dashboard.html?action=start" class="nav-item"
            onclick="if(typeof openGameModeModal === 'function'){openGameModeModal(); return false;}">
            <img src="assets/icon-start.png" class="nav-icon-img" alt="Start">
            <span class="nav-label">START</span>
        </a>
        <a href="#" class="nav-item" onclick="alert('Stats module coming soon!')">
            <img src="assets/icon-stats.png" class="nav-icon-img" alt="Stats">
            <span class="nav-label">STATS</span>
        </a>
        <a href="#" class="nav-item" onclick="alert('Coaches module coming soon!')">
            <img src="assets/icon-coaches.png" class="nav-icon-img" alt="Coaches">
            <span class="nav-label">COACHES</span>
        </a>
    </nav>
</body>

</html>